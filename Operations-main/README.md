# Интерфейс Управления Антенной

Этот проект предоставляет веб-интерфейс для управления антенной системой с использованием Raspberry Pi и микроконтроллера ESP32. Интерфейс включает в себя потоковое видео в реальном времени, интерактивные элементы управления и карту, отображающую текущее положение и направление антены. 

## Компоненты

- **main.py**: Основное приложение Flask, которое обрабатывает серверную логику, управление GPIO и конечные точки данных.
- **index.html**: HTML-файл фронтенда, отображающий пользовательский интерфейс, включая кнопки управления, видеопоток и интерактивную карту.
- **WebRTC Видеопоток**: Видеопоток в реальном времени, доступный по адресу `http://<raspberry_pi_ip>:8889/usb/`, транслирующий с камеры, подключенной к Raspberry Pi.

## Особенности

- **Кнопки Управления Антенны**: Перемещайте антенну влево, вправо или инициируйте автоматическое сканирование без перезагрузки страницы.
- **Интерактивная Карта**: Отображает текущее местоположение с двумя векторами, указывающими направление компаса и направление антены.
- **Обновления в Реальном Времени**: Карта и данные компаса обновляются каждые 5 секунд с помощью AJAX-запросов.
- **Видеопоток**: Живое видео интегрировано в интерфейс для визуальной обратной связи.

## Инструкции по Установке

### Предварительные Требования

- **Аппаратное обеспечение**:
  - Raspberry Pi с возможностями GPIO.
  - Микроконтроллер ESP32.
  - Модуль камеры, совместимый с Raspberry Pi.
- **Программное обеспечение**:
  - Установленный Python 3 на Raspberry Pi.
  - Установленный Arduino IDE на компьютере для программирования ESP32.
  - Необходимые библиотеки Python: `flask`, `gpiozero`, `pyserial`.

### Настройка Raspberry Pi

1. **Клонирование Репозитория**

   ```bash
   git clone https://github.com/yourusername/antenna-control-interface.git
   cd antenna-control-interface
   ```

2. **Установка Зависимостей Python**

   ```bash
   sudo apt-get update
   sudo apt-get install python3-pip
   pip3 install flask gpiozero pyserial
   ```

3. **Настройка Видеопотока**

   - Установите и настройте WebRTC или MJPEG стример, совместимый с вашей камерой.
   - Мы используем mediamtx, для ретрансляции и захвата потокового видео с камеры.
   - Убедитесь, что видеопоток доступен по адресу `http://<raspberry_pi_ip>:8889/usb/`.
   

4. **Запуск Приложения Flask**

   ```bash
   sudo python3 app.py
   ```

   - Примечание: Запуск с `sudo` может потребоваться для доступа к GPIO пинам и аппаратным ресурсам.

5. **Доступ к Веб-Интерфейсу**

   - Откройте веб-браузер на любом устройстве в той же сети.
   - Перейдите по адресу `http://<raspberry_pi_ip>/` для доступа к интерфейсу управления антенной.

### Настройка ESP32

1. **Подготовка Arduino IDE**

   - Установите Arduino IDE с [официального сайта](https://www.arduino.cc/en/software).
   - Добавьте поддержку плат ESP32, следуя инструкциям из [репозитория ESP32 Arduino Core](https://github.com/espressif/arduino-esp32).

2. **Загрузка Скета для ESP32**

   - Откройте предоставленный скетч для ESP32 (`.ino` файл) из репозитория.
   - Выберите `ESP32 Dev Module` (или вашу конкретную плату ESP32) в **Инструменты > Плата**.
   - Выберите правильный COM-порт в **Инструменты > Порт**.
   - Нажмите **Загрузить**, чтобы прошить код на ESP32.

3. **Подключение ESP32 к Raspberry Pi**

   - Подключите ESP32 к Raspberry Pi через USB.
   - Убедитесь, что Raspberry Pi может получать доступ к серийному порту от ESP32.

## Использование

- **Кнопки Управления**:

  - **Двигать влево (Move Left)**: Поворачивает антенну влево.
  - **Двигать вправо (Move Right)**: Поворачивает антенну вправо.
  - **Инициализировать автосканирование (Initialize Auto-Scanning)**: Запускает режим автоматического сканирования.

- **Интерактивная Карта**:

  - Отображает текущее GPS местоположение.
  - **Синяя Линия**: Представляет направление компаса.
  - **Зелёная Линия**: Представляет направление антены.

- **Видеопоток**:

  - Предоставляет живую трансляцию с камеры для визуального мониторинга.

- **Данные в Реальном Времени**:

  - Интерфейс получает обновленные данные каждые 5 секунд.
  - Для целей тестирования используются случайные значения; замените их на реальные данные сенсоров, если они у вас есть и подключены.

## Настройка и Тестирование

- **Тестирование с Случайными Данными**:

  - Приложение настроено на использование случайных значений для GPS координат, направления компаса и направления антены.
  - Это позволяет тестировать интерфейс без подключения реального оборудования.